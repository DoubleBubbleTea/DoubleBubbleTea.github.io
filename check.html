<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bảng dữ liệu và Biểu đồ Cường độ (Biểu đồ cột)</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f9fc;
      margin: 40px;
    }

    h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      display: inline-block;
      margin-right: 12px;
    }

    /* Năm dropdown */
    #yearSelect {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background-color: white;
      cursor: pointer;
      transition: border 0.2s ease;
    }
    #yearSelect:hover {
      border-color: #3498db;
    }

    table {
      border-collapse: collapse;
      width: 70%;
      background: white;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 10px;
    }

    th {
      background-color: #3498db;
      color: white;
    }

    input[type="number"] {
      width: 100%;
      border: none;
      text-align: center;
      padding: 8px;
    }

    input:focus {
      outline: 2px solid #3498db;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: flex-start;
    }

    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background-color: #1a73e8;
      transform: translateY(-2px);
    }

    canvas {
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .status-safe {
      background-color: #2ecc71;
      color: white;
      font-weight: bold;
    }
    .status-warning {
      background-color: #f39c12;
      color: white;
      font-weight: bold;
    }
    .status-danger {
      background-color: #e74c3c;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Bảng dữ liệu sản lượng, phát thải và cường độ theo quý</h2>
  <select id="yearSelect"></select> <!-- ✅ Dropdown chọn năm -->

  <div class="container">
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Quý 1</th>
          <th>Quý 2</th>
          <th>Quý 3</th>
          <th>Quý 4</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Sản lượng (tấn)</td>
          <td><input type="number" id="sanluong1" placeholder="0"></td>
          <td><input type="number" id="sanluong2" placeholder="0"></td>
          <td><input type="number" id="sanluong3" placeholder="0"></td>
          <td><input type="number" id="sanluong4" placeholder="0"></td>
        </tr>
        <tr>
          <td>Phát thải (tấn)</td>
          <td><input type="number" id="phatthai1" placeholder="0"></td>
          <td><input type="number" id="phatthai2" placeholder="0"></td>
          <td><input type="number" id="phatthai3" placeholder="0"></td>
          <td><input type="number" id="phatthai4" placeholder="0"></td>
        </tr>
        <tr>
          <td>Cường độ (tCO2/t thép)</td>
          <td><input type="number" id="cuongdo1" placeholder="0" readonly></td>
          <td><input type="number" id="cuongdo2" placeholder="0" readonly></td>
          <td><input type="number" id="cuongdo3" placeholder="0" readonly></td>
          <td><input type="number" id="cuongdo4" placeholder="0" readonly></td>
        </tr>
        <tr>
          <td>Trạng thái</td>
          <td id="status1">-</td>
          <td id="status2">-</td>
          <td id="status3">-</td>
          <td id="status4">-</td>
        </tr>
      </tbody>
    </table>

    <button id="btnXuLy">Xử lý số liệu</button>

    <canvas id="chart" width="700" height="350"></canvas>
  </div>

  <script>
    // ✅ Tạo danh sách năm từ 2000 - 2050
    const yearSelect = document.getElementById('yearSelect');
    const currentYear = new Date().getFullYear();

    for (let y = 2000; y <= 2050; y++) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = `Năm ${y}`;
      if (y === currentYear) option.selected = true;
      yearSelect.appendChild(option);
    }

    const ctx = document.getElementById('chart').getContext('2d');

    let myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Quý 1', 'Quý 2', 'Quý 3', 'Quý 4'],
        datasets: [{
          label: 'Cường độ',
          data: [0, 0, 0, 0],
          backgroundColor: ['#3498db', '#3498db', '#3498db', '#3498db'],
          borderColor: '#34495e',
          borderWidth: 1
        }]
      },
      options: {
        responsive: false,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Cường độ' },
            suggestedMax: 2
          },
          x: { title: { display: true, text: 'Các Quý' } }
        },
        plugins: {
          legend: { display: true },
          title: {
            display: true,
            text: `Biểu đồ Cường độ theo Quý (${currentYear})`
          }
        }
      }
    });

    // Khi người dùng đổi năm => cập nhật tiêu đề chart
    yearSelect.addEventListener('change', () => {
      myChart.options.plugins.title.text = `Biểu đồ Cường độ theo Quý (${yearSelect.value})`;
      myChart.update();
    });

    document.getElementById('btnXuLy').addEventListener('click', () => {
      let cuongdos = [];
      let colors = [];

      for (let i = 1; i <= 4; i++) {
        const sanluong = parseFloat(document.getElementById(`sanluong${i}`).value) || 0;
        const phatthai = parseFloat(document.getElementById(`phatthai${i}`).value) || 0;
        const statusCell = document.getElementById(`status${i}`);
        let cuongdo = 0;

        if (sanluong > 0) {
          cuongdo = (phatthai / sanluong).toFixed(2);
        }

        document.getElementById(`cuongdo${i}`).value = cuongdo;
        cuongdos.push(cuongdo);

        // Xét trạng thái và màu
        statusCell.className = '';
        if (cuongdo > 1.8) {
          statusCell.textContent = 'Vượt ngưỡng';
          statusCell.classList.add('status-danger');
          colors.push('#e74c3c');
        } else if (cuongdo >= 1.76 && cuongdo <= 1.8) {
          statusCell.textContent = 'Cận ngưỡng';
          statusCell.classList.add('status-warning');
          colors.push('#f39c12');
        } else if (cuongdo <= 1.75 && cuongdo > 0) {
          statusCell.textContent = 'An toàn';
          statusCell.classList.add('status-safe');
          colors.push('#2ecc71');
        } else {
          statusCell.textContent = '-';
          colors.push('#3498db');
        }
      }

      myChart.data.datasets[0].data = cuongdos;
      myChart.data.datasets[0].backgroundColor = colors;
      myChart.update();
    });
  </script>
</body>
</html>
