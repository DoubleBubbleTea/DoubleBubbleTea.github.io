<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bảng dữ liệu sản lượng, phát thải và cường độ theo quý</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://app.fastbots.ai/embed.js" data-bot-id="cmgbstwhn00brqv1lv77weyr0"></script>
	<script>
		window.addEventListener('load', () => {
			setTimeout(() => {
				const frame = document.querySelector('iframe[src*="fastbots"]');
				if (frame) {
					frame.style.transform = "scale(0.8)";
				}
			}, 2000); 
		});
	</script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f7f9fc;
      padding: 40px;
    }

    /* Header chứa logo và tiêu đề */
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 20px;
    }

    header img {
      position: absolute;
      left: 0;
      top: 0;
      width: 120px;
      height: auto;
    }

    header h2 {
      margin: 0;
      text-align: center;
      width: 100%;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    select,
    input[type="number"],
    button {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #3598DB;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background-color: #0056b3;
    }

    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: auto;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px 15px;
      text-align: center;
      min-width: 100px;
    }

    th {
      background-color: #3598DB;
      color: white;
    }

    .status-safe {
      background-color: #90EE90;
      font-weight: bold;
    }

    .status-warning {
      background-color: #FFD580;
      font-weight: bold;
    }

    .status-danger {
      background-color: #FF7F7F;
      font-weight: bold;
    }

    #chart-container {
      margin-top: 40px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>

  <header>
    <a href="./index.html">
    <img src="https://storage.sudospaces.com/hoaphat-com-vn/2022/02/logo-gang-thep.jpg" alt="Logo Hòa Phát"
      style="width:350px; height:auto;">
      </a>
    <h2>Bảng dữ liệu sản lượng, phát thải và cường độ theo quý</h2>
  </header>

  <div class="controls">
    <label for="yearSelect">Chọn năm:</label>
    <select id="yearSelect"></select>

    <label for="quarterCount">Số quý:</label>
    <input type="number" id="quarterCount" min="1" max="4" value="4" style="width:80px">

    <button id="createTableBtn">Tạo bảng</button>
  </div>

  <div id="table-container"></div>

  <div id="chart-container" style="display:none;">
    <canvas id="chart"></canvas>
  </div>

  <script>
    // Tạo danh sách năm
    const yearSelect = document.getElementById("yearSelect");
    for (let y = 2000; y <= 2050; y++) {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = "Năm " + y;
      yearSelect.appendChild(opt);
    }

    let chartInstance = null;

    document.getElementById("createTableBtn").addEventListener("click", () => {

      // Xóa bảng cũ
      const tableContainer = document.getElementById("table-container");
      tableContainer.innerHTML = "";

      // Xóa biểu đồ cũ nếu có
      if (chartInstance) {
        chartInstance.destroy();
        chartInstance = null;
        document.getElementById("chart-container").style.display = "none";
      }

      const count = parseInt(document.getElementById("quarterCount").value);
      if (count < 1 || count > 4) {
        alert("Vui lòng nhập số quý từ 1 đến 4");
        return;
      }

      // Tạo header
      let tableHTML = `<table id="dataTable"><tr><th>Chỉ tiêu</th>`;
      for (let i = 1; i <= count; i++) {
        tableHTML += `<th>Quý ${i}</th>`;
      }
      tableHTML += `</tr>`;

      // Các hàng dữ liệu
      const rows = ["Sản lượng (tấn)", "Phát thải (tấn)", "Cường độ (t CO2/t Thép )", "Trạng thái"];
      rows.forEach(row => {
        tableHTML += `<tr><td>${row}</td>`;
        for (let i = 1; i <= count; i++) {
          if (row === "Cường độ" || row === "Trạng thái") {
            tableHTML += `<td></td>`;
          } else {
            tableHTML += `<td><input type="number" min="0" step="any" style="width:100px"></td>`;
          }
        }
        tableHTML += `</tr>`;
      });
      tableHTML += `</table><br><div style="text-align:center;"><button id="processBtn">Xử lý số liệu</button></div>`;

      tableContainer.innerHTML = tableHTML;

      document.getElementById("processBtn").addEventListener("click", processData);
    });

    function processData() {
      const table = document.getElementById("dataTable");
      const rows = table.getElementsByTagName("tr");
      const quarters = rows[0].getElementsByTagName("th").length - 1;
      let intensities = [];

      for (let i = 1; i <= quarters; i++) {
        const sanluong = parseFloat(rows[1].getElementsByTagName("td")[i].querySelector("input").value) || 0;
        const phatthai = parseFloat(rows[2].getElementsByTagName("td")[i].querySelector("input").value) || 0;
        const cuongdo = sanluong !== 0 ? (phatthai / sanluong).toFixed(2) : 0;

        // Gán giá trị cường độ
        rows[3].getElementsByTagName("td")[i].innerText = cuongdo;

        // Xác định trạng thái
        const statusCell = rows[4].getElementsByTagName("td")[i];
        let statusText = "";
        statusCell.className = "";

        const value = parseFloat(cuongdo);
        if (value > 1.8) {
          statusText = "Vượt ngưỡng";
          statusCell.classList.add("status-danger");
        } else if (value >= 1.76 && value <= 1.8) {
          statusText = "Cận ngưỡng";
          statusCell.classList.add("status-warning");
        } else if (value <= 1.75) {
          statusText = "An toàn";
          statusCell.classList.add("status-safe");
        }
        statusCell.innerText = statusText;

        intensities.push(value);
      }

      drawChart(intensities);
    }

    function drawChart(data) {
      const ctx = document.getElementById("chart").getContext("2d");
      const quarterCount = data.length;
      const labels = [];
      for (let i = 1; i <= quarterCount; i++) labels.push("Quý " + i);

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Cường độ",
            data: data,
            backgroundColor: data.map(v =>
              v > 1.8 ? "#FF7F7F" : (v >= 1.76 && v <= 1.8) ? "#FFD580" : "#90EE90"
            ),
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false // tắt chú thích
            }
          },
scales: {
        y: {
          beginAtZero: true,
          title: { 
            display: true, 
            text: "Cường độ",
            font: { size: 18, weight: 'bold' } // tăng kích thước + in đậm
          },
          ticks: {
            font: { size: 16, weight: 'bold' } // tăng size các số trên trục y
          }
        },
        x: {
          title: { 
            display: true, 
            text: "Các quý",
            font: { size: 18, weight: 'bold' } // tăng size + in đậm
          },
          ticks: {
            font: { size: 16, weight: 'bold' } // tăng size chữ các nhãn quý
          }
        }
      }
    }
  });

  document.getElementById("chart-container").style.display = "block";
}
  </script>

</body>

</html>